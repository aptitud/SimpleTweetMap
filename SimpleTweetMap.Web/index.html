<!DOCTYPE html>
<html>
<head>
	<title>Simple TweetMap</title>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
	<meta charset="utf-8">
	<style>
		html, body, #map-canvas {
			height: 100%;
			margin: 0px;
			padding: 0px;
		}
	</style>
	<script src="Scripts/jquery-1.10.2.min.js"></script>
	<script src="Scripts/jquery.signalR-2.1.2.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
	<script src="/signalr/hubs"></script>
	<script>
		var map;
		var mapOptions;

		$(function () {

			var userHubProxy = $.connection.userHub;

			userHubProxy.client.tweet = function (dto) {
				console.log(dto);

				var contentString = '<div id="content">' +
														'<div id="siteNotice">' +
														'</div>' +
														'<h1 id="firstHeading" class="firstHeading">' + dto.sender + '</h1>' +
														'<div id="bodyContent"><p>' +
														dto.text + '</p>' +
														'</div>' +
														'</div>';

				var infowindow = new google.maps.InfoWindow({
					content: contentString
				});

				var marker = new google.maps.Marker({
					position: new google.maps.LatLng(dto.coordinates.Latitude, dto.coordinates.Longitude),
					map: map,
					title: dto.sender + " - " + dto.text
				});

				google.maps.event.addListener(marker, 'click', function () {
					infowindow.open(map, marker);
				});
			};

			

			$.connection.hub.start();
		});
		
		function initialize() {
			mapOptions = {
				zoom: 11,
				center: new google.maps.LatLng(59.325021, 18.067982)
			};

			map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
		}

		google.maps.event.addDomListener(window, 'load', initialize);

	</script>
</head>
<body>
	<div id="map-canvas"></div>
</body>
</html>